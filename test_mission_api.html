<!DOCTYPE html>
<html>
<head>
    <title>Test Mission API</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Test DWP Mission Creation API</h1>

    <div id="output" style="white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 20px; margin: 20px 0;"></div>

    <button onclick="testAuth()">Test 1: Check Auth (No Token)</button>
    <button onclick="testWithToken()">Test 2: Create Mission (With Token)</button>

    <script>
        const output = document.getElementById('output');

        function log(message) {
            output.textContent += message + '\n';
        }

        async function testAuth() {
            output.textContent = '';
            log('Testing auth endpoint without token...\n');

            try {
                const response = await fetch('https://dwp.world/wp-json/dwp/v1/missions/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'Test Mission',
                        description: 'Test description',
                        category: 'personal_memory',
                        difficulty: 'medium',
                        period_from: 1970,
                        period_to: 1980,
                        latitude: 33.8938,
                        longitude: 35.5018
                    })
                });

                const data = await response.text();
                log('Status: ' + response.status);
                log('Response: ' + data);

            } catch (error) {
                log('Error: ' + error.message);
            }
        }

        async function testWithToken() {
            const token = prompt('Enter your Firebase JWT token (get it from the app logs):');
            if (!token) return;

            output.textContent = '';
            log('Testing with token...\n');

            try {
                const response = await fetch('https://dwp.world/wp-json/dwp/v1/missions/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        title: 'Test Mission with Token',
                        description: 'Test description',
                        category: 'personal_memory',
                        difficulty: 'medium',
                        period_from: 1970,
                        period_to: 1980,
                        latitude: 33.8938,
                        longitude: 35.5018
                    })
                });

                const data = await response.text();
                log('Status: ' + response.status);
                log('Headers: ' + JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2));
                log('Response: ' + data);

            } catch (error) {
                log('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
